<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Teste PIX Sandbox</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    #qrcode { margin-top: 20px; max-width: 300px; }
  </style>
</head>
<body>
  <h2>üîê Teste de Gera√ß√£o de QR Code (Sandbox)</h2>
  <button onclick="gerarPix()">Gerar PIX</button>

  <div id="resultado" style="margin-top:20px;"></div>
  <img id="qrcode" style="display: none;" />

  <script>
    async function gerarPix() {
      const resposta = await fetch('https://duvale-production.up.railway.app/api/pix', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          valor: "10.00",
          descricao: "Teste Sandbox",
          contrato_id: "TESTE123",
          vencimento: new Date().toISOString().split("T")[0],
          user: {
            nome: "Teste Sandbox",
            email: "teste@teste.com",
            cpf: "12345678909"
          }
        })
      });

      const data = await resposta.json();

      if (resposta.ok && data.qr_code) {
        document.getElementById('qrcode').src = `data:image/png;base64,${data.qr_code}`;
        document.getElementById('qrcode').style.display = 'block';
        document.getElementById('resultado').innerHTML = `<p><strong>C√≥digo Copia e Cola:</strong><br><textarea rows="4" cols="60">${data.qr_data}</textarea></p>`;
      } else {
        document.getElementById('resultado').innerHTML = `<p style="color:red;"><strong>Erro:</strong> ${data.error || "Falha inesperada"}</p>`;
        document.getElementById('qrcode').style.display = 'none';
      }
    }
  </script>
</body>
</html>